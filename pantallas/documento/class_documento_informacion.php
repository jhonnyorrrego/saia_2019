<?php$max_salida=6; // Previene algun posible ciclo infinito limitando a 10 los ../$ruta_db_superior=$ruta="";while($max_salida>0){  if(is_file($ruta."db.php")) {    $ruta_db_superior=$ruta; //Preserva la ruta superior encontrada  }  $ruta.="../";  $max_salida--;}include_once($ruta_db_superior."db.php");function anexos_documento($iddoc,$arreglo=0){  $anexos=busca_filtro_tabla("","anexos","documento_iddocumento=".$iddoc,"",$conn);  if($arreglo)    return($anexos);  else       return($anexos["numcampos"]);}function paginas_documento($iddoc,$arreglo=0){  $paginas=busca_filtro_tabla("","pagina","id_documento=".$iddoc,"",$conn);  if($arreglo)    return($paginas);  else       return($paginas["numcampos"]);  }function notas_documento($iddoc,$arreglo=0){        if($arreglo){        $notas=array();        $notas_trans=busca_filtro_tabla("notas,fecha","buzon_salida,funcionario f1,funcionario f2","destino=f2.funcionario_codigo and origen=f1.funcionario_codigo and (destino='".usuario_actual("funcionario_codigo")."' or ver_notas=1) and (notas is not null) and archivo_idarchivo=".$iddoc,"fecha DESC",$conn);        $notas_postit=busca_filtro_tabla("comentario, fecha","comentario_img,funcionario","funcionario=login and documento_iddocumento=".$iddoc,"fecha DESC",$conn);            $notas["numcampos"]=$notas_postit["numcampos"]+$notas_trans["numcampos"];        unset($notas_postit["sql"]);        unset($notas_postit["numcampos"]);        unset($notas_postit["tabla"]);        unset($notas_trans["sql"]);        unset($notas_trans["numcampos"]);        unset($notas_trans["tabla"]);        $notas=array_merge($notas_postit,$notas_trans);                return($notas);            }    else{        $notas_trans=busca_filtro_tabla("count(*) AS cant","buzon_salida,funcionario f1,funcionario f2","destino=f2.funcionario_codigo and origen=f1.funcionario_codigo and (destino='".usuario_actual("funcionario_codigo")."' or ver_notas=1) and (notas is not null) and archivo_idarchivo=".$iddoc,"",$conn);        $notas_postit=busca_filtro_tabla("count(*) AS cant","comentario_img,funcionario","funcionario=login and documento_iddocumento=".$iddoc,"",$conn);            $notas=$notas_trans[0]["cant"]+$notas_postit[0]["cant"];           return ($notas);    }}function llamado_general_documento($iddoc,$arreglo=0){    $total["anexos"]=  anexos_documento($iddoc, $arreglo);    $total["paginas"]= paginas_documento($iddoc, $arreglo);    $total["notas"]=  notas_documento($iddoc, $arreglo);    return($total);}?>