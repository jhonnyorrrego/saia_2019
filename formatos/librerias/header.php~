<?php
if(!isset($_SESSION))
  session_start();
include_once("../db.php");
include_once("encabezado_pie_pagina.php");
  
//para exportar a word
if(isset($_REQUEST["export"])){
  $exportar=$_REQUEST["export"];
  if($exportar=="word"){

  }
}

if(!isset($_REQUEST["tipo"]) || ($_REQUEST["tipo"]==1))
  $fondo="#cccccc";
else
  $fondo="#ffffff";
  
global $conn,$dependencia,$encabezado,$plantilla;

//Definir estilos para tipo de letra y color de encabezado
//$config = busca_filtro_tabla("valor","configuracion","nombre='color_encabezado'","",$conn); 
$_REQUEST["iddoc"]=str_replace("'","",stripslashes($_REQUEST["iddoc"]));

$formato=busca_filtro_tabla("lower(plantilla) as plantilla","documento","iddocumento=".$_REQUEST["iddoc"],"",$conn); 
?>
<html>
<head>
<?php
$config = busca_filtro_tabla("valor","configuracion","nombre='color_encabezado'","",$conn); 
 if($config["numcampos"])
 {  $style = "
     <style type=\"text/css\">
      .phpmaker 
       {
       font-family: Verdana,Tahoma,arial; 
       font-size: 9px; 
       color:#000000;
       /*text-transform:Uppercase;*/
       } 
       .encabezado 
       {
       background-color:".$config[0]["valor"]."; 
       color:white ; 
       padding:10px; 
       text-align: left;	
       } 
       .encabezado_list 
       { 
       background-color:".$config[0]["valor"]."; 
       color:white ; 
       vertical-align:middle;
       text-align: center;
       font-weight: bold;	
       }
       </style>";
  echo $style;
  }
?>  
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<?php
$fuente = busca_filtro_tabla("valor","configuracion","nombre='tipo_letra'","",$conn);
 $doc=$_REQUEST["iddoc"];
 $plantilla=busca_filtro_tabla("lower(plantilla) as plantilla","documento B","iddocumento=".$doc,"",$conn);
$size=busca_filtro_tabla('font_size','formato',"nombre like '".strtolower($plantilla[0]["plantilla"])."'",'',$conn);
 //tamaño de letra cambiado por pantalla configuracion imprimir
 if(isset($_REQUEST["font_size"])&&$_REQUEST["font_size"])
    $size[0]["font_size"]=$_REQUEST["font_size"];
    
 if($fuente["numcampos"])
  echo "<style> body, table { font-size:".$size[0]["font_size"]."pt; font-family:".$fuente[0]["valor"]."; } </style>";

?>
</head>
<body bgcolor="<?php echo $fondo; ?>">

<?php

if( !isset($_REQUEST["tipo"]) || $_REQUEST["tipo"]==1)
  {
   if(!isset($_REQUEST["export"])){
     echo"<div id='div1' >";
     echo "<a target='_blank' href='../../html2ps/public_html/demo/html2ps.php?plantilla=".$formato[0]["plantilla"]."&iddoc=".$_REQUEST["iddoc"];
     if(isset($_REQUEST["destino"]))
         echo "&destino=".$_REQUEST["destino"];
     echo "'><img src='../../enlaces/imprimir.gif' height=30 width=30 border='0'></a>";
   
    $tabla=busca_filtro_tabla("nombre_tabla,encabezado,idformato,margenes","formato","nombre='".$formato[0]["plantilla"]."'","",$conn);
    $margenes=explode(",",$tabla[0]["margenes"]);
     $encabezado=busca_filtro_tabla("contenido","encabezado_formato","idencabezado_formato='".$tabla[0]["encabezado"]."'","",$conn);
      $pie=busca_filtro_tabla("encabezado",$tabla[0][0],"documento_iddocumento='".$_REQUEST["iddoc"]."'","",$conn);

     echo "</div>";
     echo "<div style='position:absolute; '>";
    echo "<table  border='0' id='tabla1' width='100%' bgcolor='white' >";
    echo("<tr ><td><div style='width:".$margenes[0]."mm; height:".$margenes[2]."mm;'>&nbsp;</div></td><td>");
     echo "<div id='encabezado' style='background-color:white;'>";

      if($pie[0][0]&&$encabezado["numcampos"])
          {
           echo crear_encabezado_pie_pagina(stripslashes($encabezado[0][0]),$_REQUEST["iddoc"],$tabla[0]["idformato"]);
          }
     echo "</div>";
    echo("</td><td><div style='width:".$margenes[1]."mm; height:".$margenes[2]."mm;'>&nbsp;</div></td></tr>");
    echo "<tr><td>&nbsp;</td><td>";
    }
  }
  echo $style;
 //echo '<link href="../librerias/estilo.css" rel="stylesheet" type="text/css">';
 if(!isset($_REQUEST["tipo"]) || $_REQUEST["tipo"]<>5 )
    {   
    echo '<table  width="100%" border="0"  valign=top align=center cellpadding="0" cellspacing="0" >';
    
    }   
   else
     {echo '<table border=0 width=100% cellpadding=0 cellspacing=0>';
     }
?>
