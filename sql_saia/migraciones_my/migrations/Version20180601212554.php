<?php

namespace Migrations;

use Doctrine\DBAL\Migrations\AbstractMigration;
use Doctrine\DBAL\Schema\Schema;

/**
 * Auto-generated Migration: Please modify to your needs!
 */
class Version20180601212554 extends AbstractMigration
{
    /**
     * @param Schema $schema
     */
    public function up(Schema $schema)
    {
    	date_default_timezone_set("America/Bogota");
    	$this->platform->registerDoctrineTypeMapping('enum', 'string');
    	$table = $schema->getTable('pantalla');
    	$this->abortIf(!$table, 'No ha configurado este SAIA para pantallas');
    	$lista_componentes= array("arbol_radio","datarange","hisgslide","acciones_pantalla","file","acciones_envio_correo","accion_transferir","conector_highslide","conector_hidden","acciones_confirmar_documento","acciones_redireccionar","seguimiento_documento","usuario_actual","ruta_documento","ruta_fija_documento","acciones_tareas_bpmni");
    	$this->activar_componentes($lista_componentes,1);
    	//Contador es el componente spin
    	$this->actualizar_contador(1);
		$this->actualizar_arbol(1);
		$this->actualizar_remitente(1);
    }

    /**
     * @param Schema $schema
     */
    public function down(Schema $schema){
        // this down() migration is auto-generated, please modify it to your needs
    	date_default_timezone_set("America/Bogota");
    	$this->platform->registerDoctrineTypeMapping('enum', 'string');
    	$lista_componentes= array("arbol_radio","datarange","hisgslide","acciones_pantalla","file","acciones_envio_correo","accion_transferir","conector_highslide","conector_hidden","acciones_confirmar_documento","acciones_redireccionar","seguimiento_documento","usuario_actual","ruta_documento","ruta_fija_documento","acciones_tarea_bpmni");
    	$this->activar_componentes($lista_componentes,0);
    	//Contador es el componente spin
    	$this->actualizar_contador(0);
    	$this->actualizar_arbol(0);
    	$this->actualizar_remitente(0);
    }
    
    function activar_componentes($lista,$accion){
    	$condicion =" estado=1 ";
    	if($accion==1){
    		$condicion=" estado=0 ";
    	}
    	$this->addSql("UPDATE pantalla_componente SET ".$condicion." WHERE nombre IN('".implode("','",$lista)."')");
    }
    function actualizar_contador($accion){
    	if($accion==1){
    		$cadena_sql="UPDATE pantalla_componente SET  etiqueta='Contador', clase='icon-contador', componente='<div class=\"control-group element\" idpantalla_componente=\"{*idpantalla_componente*}\" idpantalla_campo=\"{*idpantalla_campos*}\" id=\"pc_{*idpantalla_campos*}\" nombre=\"{*nombre_componente*}\">\n  {*clase_eliminar_pantalla_componente*} \n  <label class=\"control-label\" for=\"{*nombre*}\"><b>{*etiqueta*}{*obligatoriedad*}</b>\n  </label>\n  <div class=\"controls\"> \n		<div id=\"\" class=\"input-append\">\n			<input id=\"{*nombre*}\" type=\"text\" value=\"{*procesar_contador*}\" class=\"\" style=\"width:70px\" name=\"{*nombre*}\">\n<button class=\"btn\" type=\"button\" style=\"height:27px\" id=\"up_{*nombre*}\">+</button>\n<button class=\"btn\" type=\"button\" style=\"height:27px\" id=\"down_{*nombre*}\">-</button>\n		</div>\n  </div>\n</div>\n<script>\n$(document).ready(function(){\n    $(\"#up_{*nombre*}\").click(function(){\nvar campo=$(\"#{*nombre*}\").val();\nif(parseInt(campo)||campo==0)$(\"#{*nombre*}\").val(parseInt(campo)+1);\nelse $(\"#{*nombre*}\").val(0);\n    });\n$(\"#down_{*nombre*}\").click(function(){\nvar campo=$(\"#{*nombre*}\").val();\nif(parseInt(campo)||campo==0)$(\"#{*nombre*}\").val(parseInt(campo)-1);\nelse $(\"#{*nombre*}\").val(0);\n    });\n});\n</script>', opciones='{\"nombre\":\"contador\",\"etiqueta\":\"Contador\",\"tipo_dato\":\"varchar\",\"longitud\":\"255\",\"obligatoriedad\":0,\"valor\":\"\",\"acciones\":\"a,e,b\",\"ayuda\":\"\",\"predeterminado\":\"\",\"banderas\":\"\",\"etiqueta_html\":\"spin\",\"orden\":1,\"mascara\":\"\",\"adicionales\":\"\",\"autoguardado\":1,\"fila_visible\":1,\"placeholder\":\"\"}', categoria='Texto',estado=1, tipo_componente= 1, etiqueta_html='spin' WHERE nombre='contador'";
    	}
    	else{
    		$cadena_sql="UPDATE pantalla_componente SET nombre='contador', etiqueta='Contador', clase='icon-contador', componente='<div class=\"control-group element\" idpantalla_componente=\"{*idpantalla_componente*}\" idpantalla_campo=\"{*idpantalla_campos*}\" id=\"pc_{*idpantalla_campos*}\" nombre=\"{*nombre_componente*}\">\n  {*clase_eliminar_pantalla_componente*} \n  <label class=\"control-label\" for=\"{*nombre*}\"><b>{*etiqueta*}{*obligatoriedad*}</b>\n  </label>\n  <div class=\"controls\"> \n		<div id=\"\" class=\"input-append\">\n			<input id=\"{*nombre*}\" type=\"text\" value=\"{*procesar_contador*}\" class=\"\" style=\"width:70px\" name=\"{*nombre*}\">\n<button class=\"btn\" type=\"button\" style=\"height:27px\" id=\"up_{*nombre*}\">+</button>\n<button class=\"btn\" type=\"button\" style=\"height:27px\" id=\"down_{*nombre*}\">-</button>\n		</div>\n  </div>\n</div>\n<script>\n$(document).ready(function(){\n    $(\"#up_{*nombre*}\").click(function(){\nvar campo=$(\"#{*nombre*}\").val();\nif(parseInt(campo)||campo==0)$(\"#{*nombre*}\").val(parseInt(campo)+1);\nelse $(\"#{*nombre*}\").val(0);\n    });\n$(\"#down_{*nombre*}\").click(function(){\nvar campo=$(\"#{*nombre*}\").val();\nif(parseInt(campo)||campo==0)$(\"#{*nombre*}\").val(parseInt(campo)-1);\nelse $(\"#{*nombre*}\").val(0);\n    });\n});\n</script>', opciones= '{\"nombre\":\"contador\",\"etiqueta\":\"Contador\",\"tipo_dato\":\"varchar\",\"longitud\":\"255\",\"obligatoriedad\":0,\"valor\":\"\",\"acciones\":\"a,e,b\",\"ayuda\":\"\",\"predeterminado\":\"\",\"banderas\":\"\",\"etiqueta_html\":\"contador\",\"orden\":1,\"mascara\":\"\",\"adicionales\":\"\",\"autoguardado\":1,\"fila_visible\":1,\"placeholder\":\"\"}', categoria= 'Texto', estado=1,tipo_componente= 1, etiqueta_html='contador' WHERE nombre='contador'";
    	}
    	$this->addSql($cadena_sql);
    }
    function actualizar_arbol($accion){
    	if($accion==1){
    		$cadena_sql="UPDATE pantalla_componente SET etiqueta='Arbol', clase='icon-checkbox', componente='<div class=\"control-group element\" idpantalla_componente=\"{*idpantalla_componente*}\" idpantalla_campo=\"{*idpantalla_campos*}\" id=\"pc_{*idpantalla_campos*}\" nombre=\"{*nombre_componente*}\">{*clase_eliminar_pantalla_componente*} \n  <label class=\"control-label\" for=\"{*nombre*}\"><b>{*etiqueta*}{*obligatoriedad*}</b>\n  </label>\n  <div class=\"controls\"> \n    {*cargar_listado_inicial_arbol_checkbox*}  \n    {*busca_componente_arbol_checkbox*}\n    <div id=\"esperando_{*nombre*}\"><img src=\"{*obtener_ruta_db_superior*}imagenes/cargando.gif\"></div>\n    <div id=\"treebox_{*nombre*}\" height=\"90%\" class=\"arbol_saia\"></div>		    \n    <script type=\"text/javascript\">\n    $(document).ready(function(){\n    	var browserType;\n      if (document.layers) {browserType = \"nn4\"}\n      if (document.all) {browserType = \"ie\"}\n      if (window.navigator.userAgent.toLowerCase().match(\"gecko\")) {browserType= \"gecko\"}\n    	tree_{*nombre*}=new dhtmlXTreeObject(\"treebox_{*nombre*}\",\"100%\",\"\",0);\ntree_{*nombre*}.enableTreeImages(false);    	tree_{*nombre*}.setImagePath(\"{*obtener_ruta_db_superior*}imgs/\");\n    	tree_{*nombre*}.enableIEImageFix(true);              \n    	tree_{*nombre*}.setOnLoadingStart(cargando_{*nombre*});\n    	tree_{*nombre*}.setOnLoadingEnd(fin_cargando_{*nombre*});\n      tree_{*nombre*}.enableCheckBoxes(1);\n      {*padre_independiente_arbol_checkbox*}\n    	tree_{*nombre*}.setOnCheckHandler(onNodeSelect_{*nombre*});\n    	{*load_datos_arbol_checkbox*}	\n            function fin_cargando_{*nombre*}(){\n    		if (browserType == \"gecko\")\n    			document.poppedLayer = eval(\'document.getElementById(\"esperando_{*nombre*}\")\')\n    		else if (browserType == \"ie\")\n    			document.poppedLayer = eval(\'document.getElementById(\"esperando_{*nombre*}\")\');\n    		else\n    			document.poppedLayer = eval(\'document.layers[\"esperando_{*nombre*}\"]\');\n    			document.poppedLayer.style.display = \"none\";\n    	}\n            \n            function cargando_{*nombre*}() {\n    		if (browserType == \"gecko\" )\n    			document.poppedLayer = eval(\'document.getElementById(\"esperando_{*nombre*}\")\');\n    		else if (browserType == \"ie\")\n    			document.poppedLayer = eval(\'document.getElementById(\"esperando_{*nombre*}\")\');\n    		else\n    			document.poppedLayer =	eval(\'document.layers[\"esperando_{*nombre*}\"]\');\n    			document.poppedLayer.style.display = \"\";\n    	}\n      function onNodeSelect_{*nombre*}(nodeId){\n        valor_destino=document.getElementById(\"{*nombre*}\");\n				\n					destinos=tree_{*nombre*}.getAllChecked();\n					var nuevos_valores=destinos.split(\",\");\n					var cantidad=nuevos_valores.length;\n					var funcionarios=new Array();\n					var indice=0;\n					for(var i=0;i<cantidad;i++){\n						if(nuevos_valores[i].indexOf(\"#\")==\"-1\"){\n							if(nuevos_valores[i]!=\"\"){\n								funcionarios[indice]=nuevos_valores[i];\n								indice++;\n							}\n						}\n					}\n					valor_destino.value=funcionarios.join(\",\");\n				\n      }\n    	{*caracteristicas_arbol_checkbox*}		\n    });\n    </script>		\n  </div>\n</div>',opciones= '{\"nombre\":\"arbol_checkbox\",\"etiqueta\":\"Arboles \",\"tipo_dato\":\"varchar\",\"longitud\":\"255\",\"obligatoriedad\":1,\"valor\":\"../../pantallas/lib/arbol_funcionarios.php;1;0;1;1;0;0\",\"acciones\":\"a,e,b\",\"ayuda\":\"\",\"predeterminado\":\"\",\"banderas\":\"\",\"etiqueta_html\":\"arbol\",\"orden\":1,\"mascara\":\"\",\"adicionales\":\"\",\"autoguardado\":1,\"fila_visible\":1}', procesar='mostrar_arbol_checkbox', categoria='Arbol', estado=1, librerias = 'js/dhtmlXTree.js,js/dhtmlXCommon.js,css/dhtmlXTree.css,pantallas/lib/librerias_codificacion.js,pantallas/lib/librerias_arboles.js,css/bootstrap/saia/css/bootstrap_reescribir.css', tipo_componente=1, eliminar='', etiqueta_html='arbol' WHERE nombre='arbol_checkbox'";
    	}
    	else{
    		$cadena_sql="UPDATE pantalla_componente SET etiqueta= 'Arbol checkbox', clase='icon-checkbox', componente='<div class=\"control-group element\" idpantalla_componente=\"{*idpantalla_componente*}\" idpantalla_campo=\"{*idpantalla_campos*}\" id=\"pc_{*idpantalla_campos*}\" nombre=\"{*nombre_componente*}\">{*clase_eliminar_pantalla_componente*} \n  <label class=\"control-label\" for=\"{*nombre*}\"><b>{*etiqueta*}{*obligatoriedad*}</b>\n  </label>\n  <div class=\"controls\"> \n    {*cargar_listado_inicial_arbol_checkbox*}  \n    {*busca_componente_arbol_checkbox*}\n    <div id=\"esperando_{*nombre*}\"><img src=\"{*obtener_ruta_db_superior*}imagenes/cargando.gif\"></div>\n    <div id=\"treebox_{*nombre*}\" height=\"90%\" class=\"arbol_saia\"></div>		    \n    <script type=\"text/javascript\">\n    $(document).ready(function(){\n    	var browserType;\n      if (document.layers) {browserType = \"nn4\"}\n      if (document.all) {browserType = \"ie\"}\n      if (window.navigator.userAgent.toLowerCase().match(\"gecko\")) {browserType= \"gecko\"}\n    	tree_{*nombre*}=new dhtmlXTreeObject(\"treebox_{*nombre*}\",\"100%\",\"\",0);\ntree_{*nombre*}.enableTreeImages(false);    	tree_{*nombre*}.setImagePath(\"{*obtener_ruta_db_superior*}imgs/\");\n    	tree_{*nombre*}.enableIEImageFix(true);              \n    	tree_{*nombre*}.setOnLoadingStart(cargando_{*nombre*});\n    	tree_{*nombre*}.setOnLoadingEnd(fin_cargando_{*nombre*});\n      tree_{*nombre*}.enableCheckBoxes(1);\n      {*padre_independiente_arbol_checkbox*}\n    	tree_{*nombre*}.setOnCheckHandler(onNodeSelect_{*nombre*});\n    	{*load_datos_arbol_checkbox*}	\n            function fin_cargando_{*nombre*}(){\n    		if (browserType == \"gecko\")\n    			document.poppedLayer = eval(\'document.getElementById(\"esperando_{*nombre*}\")\')\n    		else if (browserType == \"ie\")\n    			document.poppedLayer = eval(\'document.getElementById(\"esperando_{*nombre*}\")\');\n    		else\n    			document.poppedLayer = eval(\'document.layers[\"esperando_{*nombre*}\"]\');\n    			document.poppedLayer.style.display = \"none\";\n    	}\n            \n            function cargando_{*nombre*}() {\n    		if (browserType == \"gecko\" )\n    			document.poppedLayer = eval(\'document.getElementById(\"esperando_{*nombre*}\")\');\n    		else if (browserType == \"ie\")\n    			document.poppedLayer = eval(\'document.getElementById(\"esperando_{*nombre*}\")\');\n    		else\n    			document.poppedLayer =	eval(\'document.layers[\"esperando_{*nombre*}\"]\');\n    			document.poppedLayer.style.display = \"\";\n    	}\n      function onNodeSelect_{*nombre*}(nodeId){\n        valor_destino=document.getElementById(\"{*nombre*}\");\n				\n					destinos=tree_{*nombre*}.getAllChecked();\n					var nuevos_valores=destinos.split(\",\");\n					var cantidad=nuevos_valores.length;\n					var funcionarios=new Array();\n					var indice=0;\n					for(var i=0;i<cantidad;i++){\n						if(nuevos_valores[i].indexOf(\"#\")==\"-1\"){\n							if(nuevos_valores[i]!=\"\"){\n								funcionarios[indice]=nuevos_valores[i];\n								indice++;\n							}\n						}\n					}\n					valor_destino.value=funcionarios.join(\",\");\n				\n      }\n    	{*caracteristicas_arbol_checkbox*}		\n    });\n    </script>		\n  </div>\n</div>', opciones='{\"nombre\":\"arbol_checkbox\",\"etiqueta\":\"Arbol de funcionario checkbox\",\"tipo_dato\":\"varchar\",\"longitud\":\"255\",\"obligatoriedad\":1,\"valor\":\"pantallas/lib/arbol_funcionarios.php?rol=1|1|0|1|1|0|5\",\"acciones\":\"a,e,b\",\"ayuda\":\"\",\"predeterminado\":\"\",\"banderas\":\"\",\"etiqueta_html\":\"arbol_checkbox\",\"orden\":1,\"mascara\":\"\",\"adicionales\":\"\",\"autoguardado\":1,\"fila_visible\":1}', procesar='mostrar_arbol_checkbox', categoria='Arbol', estado= 1, librerias= 'js/dhtmlXTree.js,js/dhtmlXCommon.js,css/dhtmlXTree.css,pantallas/lib/librerias_codificacion.js,pantallas/lib/librerias_arboles.js,css/bootstrap/saia/css/bootstrap_reescribir.css', tipo_componente=1, eliminar='', etiqueta_html='arbol_checkbox' WHERE nombre='arbol_checkbox'";
    	}
    	$this->addSql($cadena_sql);
    }
    function actualizar_remitente($accion){
    	if($accion==1){
    		$cadena_sql="UPDATE pantalla_componente SET nombre='ejecutor', etiqueta='Remitente', clase='icon-remitente', componente='<div class=\"control-group element\" idpantalla_componente=\"{*idpantalla_componente*}\" idpantalla_campo=\"{*idpantalla_campos*}\" id=\"pc_{*idpantalla_campos*}\" nombre=\"{*nombre_componente*}\">{*clase_eliminar_pantalla_componente*}\r\n  <label class=\"control-label\" for=\"label_{*nombre*}\"><b>{*etiqueta*}{*obligatoriedad*}</b>\r\n  </label>\r\n  <div class=\"controls\">\r\n    {*procesar_remitente*}\r\n  </div>\r\n</div>', opciones= '{\"nombre\":\"ejecutor\",\"etiqueta\":\"Remitente\",\"tipo_dato\":\"varchar\",\"longitud\":\"255\",\"obligatoriedad\":1,\"valor\":\"unico@identificacion,nombre@empresa,cargo,direccion,telefono\",\"acciones\":\"a,e,b\",\"ayuda\":\"\",\"predeterminado\":\"1\",\"banderas\":\"\",\"etiqueta_html\":\"ejecutor\",\"orden\":1,\"mascara\":\"\",\"adicionales\":\"\",\"autoguardado\":1,\"fila_visible\":1,\"placeholder\":\"\"}', procesar='mostrar_remitente', categoria= 'Remitente', estado=1, librerias= 'anexosdigitales/highslide-4.0.10/highslide/highslide.css@h,anexosdigitales/highslide-4.0.10/highslide/highslide-full.js@h,pantallas/generador/remitente/funciones_remitente.php', tipo_componente=1, eliminar='', etiqueta_html='ejecutor' WHERE nombre='remitente'";
    	}
    	else{
    		$cadena_sql="UPDATE pantalla_componente SET nombre='remitente', etiqueta= 'Remitente', clase='icon-remitente', componente='<div class=\"control-group element\" idpantalla_componente=\"{*idpantalla_componente*}\" idpantalla_campo=\"{*idpantalla_campos*}\" id=\"pc_{*idpantalla_campos*}\" nombre=\"{*nombre_componente*}\">{*clase_eliminar_pantalla_componente*}\n  <label class=\"control-label\" for=\"label_{*nombre*}\"><b>{*etiqueta*}{*obligatoriedad*}</b>\n  </label>\n  <div class=\"controls\">\n    {*procesar_remitente*}\n    <script type=\"text/javascript\">\n    $(document).ready(function(){\n	  hs.graphicsDir = \"{*obtener_ruta_db_superior*}highslide/graphics/\";\n      hs.outlineType = \"rounded-white\";\n      $(\"#capa_{*nombre*}\").live(\"click\",function(e){\n		e.preventDefault();\n        hs.htmlExpand(this, { objectType: \'iframe\',width: 700, height: 500,contentId:\'cuerpo_paso\', preserveContent:false, src:\'{*obtener_ruta_db_superior*}pantallas/buscador_principal.php?idbusqueda=87&variable_busqueda={*nombre*}\',outlineType: \'rounded-white\',wrapperClassName: \'highslide-wrapper drag-header\'});\n      });\n    });    \n    </script>\n  </div>\n</div>', opciones='{\"nombre\":\"remitente\",\"etiqueta\":\"Remitente\",\"tipo_dato\":\"varchar\",\"longitud\":\"255\",\"obligatoriedad\":1,\"valor\":\"\",\"acciones\":\"a,e,b\",\"ayuda\":\"\",\"predeterminado\":\"\",\"banderas\":\"\",\"etiqueta_html\":\"remitente\",\"orden\":1,\"mascara\":\"\",\"adicionales\":\"\",\"autoguardado\":1,\"fila_visible\":1,\"placeholder\":\"\"}', procesar='mostrar_remitente', categoria='Remitente', estado=1, librerias= 'anexosdigitales/highslide-4.0.10/highslide/highslide.css@h,anexosdigitales/highslide-4.0.10/highslide/highslide-full.js@h,pantallas/generador/remitente/funciones_remitente.php', tipo_componente= 1, eliminar='', etiqueta_html='remitente' WHERE nombre='ejecutor'";
    	}
    	$this->addSql($cadena_sql);
    }
}
