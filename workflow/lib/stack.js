function Stack(){this.figures=[];this.groups=[];this.currentId=0;this.idToIndex=[];this.oType="Stack"}Stack.load=function(b){var a=new Stack();a.figures=Figure.loadArray(b.figures);a.groups=Group.loadArray(b.groups);a.figureSelectedIndex=b.figureSelectedIndex;a.currentId=b.currentId;a.idToIndex=b.idToIndex;return a};Stack.prototype={groupCreate:function(e){for(var a=0;a<this.groups.length;a++){if(this.groups[a].permanent==false){throw"Stack::groupCreate()  You can not create new groups while you have temporary groups alive"}}var c=new Group();for(var a=0;a<e.length;a++){var d=this.figureGetById(e[a]);d.groupId=c.id}var b=c.getBounds();c.rotationCoords.push(new Point(b[0]+(b[2]-b[0])/2,b[1]+(b[3]-b[1])/2));c.rotationCoords.push(new Point(b[0]+(b[2]-b[0])/2,b[1]));this.groups.push(c);return c.id},groupGetById:function(b){for(var a=0;a<this.groups.length;a++){if(this.groups[a].id==b){return this.groups[a]}}return null},groupDestroy:function(c){var a=-1;for(var b=0;b<this.groups.length;b++){if(this.groups[b].id==c){a=b;break}}if(a>-1){this.groups.splice(a,1);var d=this.figureGetByGroupId(c);for(var b=0;b<d.length;b++){d[b].groupId=-1}}},equals:function(b){var c="";if(!b instanceof Stack){return false;c+="not same class"}if(this.figures.length!=b.figures.length){c+="not same nr of figures";return false}for(var a=0;a<this.figures.length;a++){if(!this.figures[a].equals(b.figures[a])){c+="figures not the same";return false}}if(this.groups.length!=b.groups.length){c+="not same nr of groups";return false}for(var a=0;a<this.groups.length;a++){if(!this.groups[a].equals(b.groups[a])){c+="groups not the same";return false}}for(var a=0;a<this.figures.idToIndex;a++){if(this.idToIndex[a]!=undefined&&b.idToIndex!=undefined&&this.idToIndex[a]!=b.idToIndex[a]){c+="not same idToIndex";return false}}if(this.currentId!=b.currentId){c+="not same currentId";return false}if(c!=""){alert(c)}return true},generateId:function(){return this.currentId++},figureAdd:function(a){this.figures.push(a);this.idToIndex[a.id]=this.figures.length-1},figureRemove_deprecated:function(a){var b=-1;for(var c=0;c<this.figures.length;c++){if(this.figures[c]==a){b=c;break}}CONNECTOR_MANAGER.connectionPointRemoveAllByParent(a.id);if(b>-1){this.figures.splice(b,1);for(var c=b;c<this.figures.length;c++){this.idToIndex[this.figures[c].id]=c}}if(b<this.figureSelectedIndex&&b!=-1){this.figureSelectedIndex--}},figureRemoveById:function(c){var a=-1;for(var b=0;b<this.figures.length;b++){if(this.figures[b].id==c){a=b;break}}if(a>-1){this.figures.splice(a,1);this.reindex()}},reindex:function(){for(var a=0;a<this.figures.length;a++){this.idToIndex[this.figures[a].id]=a}},reset:function(){this.figures=[];this.figureSelectedIndex=-1;this.currentId=0},getIndex:function(a){for(var b=0;b<this.figures.length;b++){if(this.figures[b]==a){return b}}return -1},figureGetByGroupId:function(b){var c=[];for(var a=0;a<this.figures.length;a++){if(this.figures[a].groupId==b){c.push(this.figures[a])}}return c},figureGetIdsByGroupId:function(b){var c=[];for(var a=0;a<this.figures.length;a++){if(this.figures[a].groupId==b){c.push(this.figures[a].id)}}return c},figureGetById:function(b){for(var a=0;a<this.figures.length;a++){if(this.figures[a].id==b){return this.figures[a]}}return null},figureGetByXY:function(a,d){var c=-1;for(var b=this.figures.length-1;b>=0;b--){if(this.figures[b].contains(a,d)){c=this.figures[b].id;break}}return c},setPosition_deprecated:function(b,a){var d=-1;for(var e=0;e<this.figures.length;e++){if(this.figures[e]==b){d=e}}if(d!=-1&&a>=0&&a<this.figures.length){var c=this.figures.splice(d,1);this.figures.splice(a,0,c[0]);var f=false;for(var e=0;e<this.figures.length;e++){this.idToIndex[this.figures[e].id]=e}this.figureSelectedIndex=a}},swapToPosition:function(c,b){var d=this.idToIndex[c];if(d!=-1&&b>=0&&b<this.figures.length){this.idToIndex[c]=b;this.idToIndex[this.figures[b].id]=d;var a=this.figures[d];this.figures[d]=this.figures[b];this.figures[b]=a}},setPosition:function(d,c){var e=this.idToIndex[d];var a=this.figures[e];var f=-1;if(e<c){f=1}Log.info(f);for(var b=e;b!=c;b+=f){this.figures[b]=this.figures[b+f];this.idToIndex[this.figures[b].id]=b}this.figures[c]=a;this.idToIndex[this.figures[c].id]=c},figureIsOver:function(b,e){var d=false;for(var c=0;c<this.figures.length;c++){var a=this.figures[c];if(a.contains(b,e)){d=true;break}}return d},paint:function(b){for(var a=0;a<this.figures.length;a++){if(!b.save){alert("save() no present")}b.save();this.figures[a].paint(b);b.restore();if(state==STATE_CONNECTOR_PICK_FIRST||state==STATE_CONNECTOR_PICK_SECOND||state==STATE_CONNECTOR_MOVE_POINT){CONNECTOR_MANAGER.connectionPointPaint(b,this.figures[a].id)}}if(state==STATE_FIGURE_SELECTED){var e=this.figureGetById(selectedFigureId);HandleManager.figureSet(e);HandleManager.paint(b)}else{if(state==STATE_CONNECTOR_SELECTED){var h=CONNECTOR_MANAGER.connectorGetById(selectedConnectorId);HandleManager.figureSet(h);HandleManager.paint(b)}else{if(state==STATE_GROUP_SELECTED){var d=this.groupGetById(selectedGroupId);HandleManager.figureSet(d);HandleManager.paint(b)}}}CONNECTOR_MANAGER.connectorPaint(b,selectedConnectorId);if(state==STATE_SELECTING_MULTIPLE){selectionArea.paint(b);Log.info(selectionArea.toString())}},toSVG:function(){var a=" ";for(var b=0;b<this.figures.length;b++){a+=this.figures[b].toSVG()}return a}};