<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Render Example | Kukudocs JS Document Viewer</title>
    <meta name="author" content="KUKUDOCS">
    <meta name="description" content="An example of Page Control width kukudocs js document viewer">
</head>
<body>

<p style="font-size:24px; margin: 50px 0;"> Example of Page Control width kukudocs js document viewer </p>


<div class="container main-container">
    <input id="files" type="file" name="files[]" multiple="false">
    <button id="view-btn">view button</button>

    <!--control button-->
    <button id="prev-btn">prev button</button>
    <button id="next-btn">next button</button>

    <button id="zoom-in-btn">zoom in button</button>
    <button id="zoom-out-btn">zoom out button</button>

    <button id="max-zoom-set-btn">Maximum Zoom Set button</button>
    <button id="min-zoom-set-btn">Minimum Zoom Set button</button>
    <button id="zoom-scale-set-btn">Zoom Scale Set button</button>

    <div id="kuku-viewer-node" style="width:1000px; height: 500px; border:1px solid #eee; margin: 20px 0;"></div>
</div>

<script type="text/javascript" src="../scripts/_lib/jquery.1.12.3.min.js"></script>
<script type="text/javascript" src="../scripts/docxjs/DocxJS.bundle.min.js"></script>
<script type="text/javascript" src="../scripts/celljs/CellJS.bundle.min.js"></script>
<script type="text/javascript" src="../scripts/slidejs/SlideJS.bundle.min.js"></script>
<script type="text/javascript" src="../scripts/pdfjs/PdfJS.bundle.min.js"></script>

<script>
    $(document).ready(function () {
        var maxZoom = 3;
        var minZoom = 0.5;
        var zoomScale = 0.5;

        var $kukuNode = $("#kuku-viewer-node");
        var $files = $("#files");
        var $button = $("#view-btn");

        var $prevbutton = $("#prev-btn");
        var $nextbutton = $("#next-btn");

        var $zoomInbutton = $("#zoom-in-btn");
        var $zoomOutbutton = $("#zoom-out-btn");

        var $maxZoomSetButton = $("#max-zoom-set-btn");
        var $minZoomSetButton = $("#min-zoom-set-btn");
        var $zoomScaleSetButton = $("#zoom-scale-set-btn");

        var instance = null, fileType = null;
        var docxJS = null, cellJS = null, slideJS = null, pdfJS = null;

        var documentParser = function (file) {
            fileType = getInstanceOfFileType(file);

            if (fileType) {
                if (instance) {
                    /** destroy API
                     *  structure : destory(callback) **/
                    instance.destroy();
                }

                if (fileType === 'docx') {
                    if (!docxJS) {
                        docxJS = new DocxJS();
                    }
                    instance = docxJS;
                } else if (fileType === 'xlsx') {
                    if (!cellJS) {
                        cellJS = new CellJS();
                    }
                    instance = cellJS;
                } else if (fileType === 'pptx') {
                    if (!slideJS) {
                        slideJS = new SlideJS();
                    }
                    instance = slideJS;
                } else if (fileType === 'pdf') {
                    if (!pdfJS) {
                        pdfJS = new PdfJS();
                    }
                    instance = pdfJS;

                    instance.setCMapUrl('cmaps/');
                }

                /** Maximum & Minimum Zoom Setting API  **/
                instance.setMaxZoom(maxZoom);
                instance.setMinZoom(minZoom);

                if (instance) {
                    /** parse API
                     *  structure : parse(file, successCallbackFn, errorCallbackFn) **/
                    instance.parse(file,
                        function () {
                            /** render API
                             *  structure : render(element, callbackFn, pageId) **/
                            instance.render($kukuNode[0], function () {
                            });
                        },
                        function () {
                            console.log('document js viewer parsing error');
                        });
                } else {
                    console.log('no support files');
                }
            } else {
                console.log('no support files');
            }
        };


        //Utils
        var stopEvent = function (e) {
            if (e.preventDefault) e.preventDefault();
            if (e.stopPropagation) e.stopPropagation();
            e.returnValue = false;
            e.cancelBubble = true;
            e.stopped = true;
        };

        var getInstanceOfFileType = function (file) {
            var fileExtension = null;
            if (file) {
                var fileName = file.name;
                fileExtension = fileName.split('.').pop();
            }
            return fileExtension;
        };

        //Event
        var selectFile = null, currentId = null;
        $files.on('change', function (e) {
            stopEvent(e);
            selectFile = e.target.files[0];
        });
        $button.on('click', function (e) {
            stopEvent(e);

            if (selectFile) {
                documentParser(selectFile);
            } else {
                alert('no selected file');
            }
        });


        $prevbutton.on('click', function (e) {
            stopEvent(e);
            if (instance) {
                if (fileType === 'docx') {
                    console.log('no support prev page');
                } else if (fileType === 'xlsx') {
                    /** getFileInfo API
                     *  structure : getFileInfo() **/
                    var fileInfo = instance.getFileInfo();
                    if (fileInfo.sheetNames) {
                        /** getCurrentId API
                         *  structure : getCurrentId() **/
                        currentId = instance.getCurrentId();
                        var sheetId = null, isFind = false;
                        $.each(fileInfo.sheetNames, function () {
                            if (currentId === this.sheetId) {
                                isFind = true
                            } else if (isFind === false) {
                                sheetId = this.sheetId;
                            }
                        });

                        if (sheetId && sheetId !== currentId) {
                            /** gotoPage API
                             *  structure : getCurrentId(pageId) **/
                            instance.gotoPage(sheetId);
                        }
                    }
                } else if (fileType === 'pptx' || fileType === 'pdf') {
                    currentId = instance.getCurrentId();
                    instance.gotoPage(currentId - 1);
                }
            }
        });
        $nextbutton.on('click', function (e) {
            stopEvent(e);
            if (instance) {
                if (fileType === 'docx') {
                    console.log('no support next page');
                } else if (fileType === 'xlsx') {
                    var fileInfo = instance.getFileInfo();
                    if (fileInfo.sheetNames) {
                        currentId = instance.getCurrentId();

                        var sheetId = null;
                        $.each(fileInfo.sheetNames, function () {
                            if (sheetId === -1) {
                                sheetId = this.sheetId;
                            }
                            if (currentId === this.sheetId) {
                                sheetId = -1;
                            }
                        });

                        if (sheetId && sheetId !== currentId) {
                            instance.gotoPage(sheetId);
                        }
                    }
                } else if (fileType === 'pptx' || fileType === 'pdf') {
                    currentId = instance.getCurrentId();
                    instance.gotoPage(currentId + 1);
                }
            }
        });

        $zoomInbutton.on('click', function (e) {
            stopEvent(e);
            if (instance) {
                /** getZoom API
                 *  structure : getZoom() **/
                var currentZoom = instance.getZoom();

                /** setZoom API
                 *  structure : setZoom(zoomVal) **/
                instance.setZoom(currentZoom + zoomScale);
            }
        });
        $zoomOutbutton.on('click', function (e) {
            stopEvent(e);
            var currentZoom = instance.getZoom();
            instance.setZoom(currentZoom - zoomScale);
        });

        $maxZoomSetButton.on('click', function (e) {
            stopEvent(e);
            var inputMaxZoomValue = prompt('Please enter a zoom maximum.', maxZoom);

            inputMaxZoomValue = inputMaxZoomValue * 1;

            if (isNaN(inputMaxZoomValue)) {
                alert('It is not a numeric value.');
            } else {
                maxZoom = inputMaxZoomValue;

                if (instance) {
                    instance.setMaxZoom(maxZoom);
                }
            }
        });

        $minZoomSetButton.on('click', function (e) {
            stopEvent(e);
            var inputMinZoomValue = prompt('Please enter a zoom minimum.', minZoom);

            inputMinZoomValue = inputMinZoomValue * 1;

            if (isNaN(inputMinZoomValue)) {
                alert('It is not a numeric value.');
            } else {
                minZoom = inputMinZoomValue;

                if (instance) {
                    instance.setMinZoom(minZoom);
                }
            }
        });

        $zoomScaleSetButton.on('click', function (e) {
            stopEvent(e);
            var inputZoomScaleValue = prompt('Please enter a zoom scale.', zoomScale);

            inputZoomScaleValue = inputZoomScaleValue * 1;

            if (isNaN(inputZoomScaleValue)) {
                alert('It is not a numeric value.');
            } else {
                zoomScale = inputZoomScaleValue;
            }
        });
    });
</script>
</body>
</html>